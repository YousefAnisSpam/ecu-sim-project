<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Server Queue - Queuing Simulation</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .distribution-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
        }
        
        .distribution-table th {
            background-color: #2c3e50;
            color: white;
            padding: 12px;
            text-align: center;
        }
        
        .distribution-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
        
        .distribution-table input {
            width: 80px;
            padding: 8px;
            text-align: center;
        }
        
        .add-row-btn, .remove-row-btn {
            padding: 8px 15px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .add-row-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        .remove-row-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .simulation-table {
            width: 100%;
            overflow-x: auto;
            margin: 20px 0;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .simulation-table table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        .simulation-table th {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            text-align: center;
            position: sticky;
            top: 0;
            font-weight: 600;
        }
        
        .simulation-table td {
            padding: 8px 6px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }
        
        .simulation-table tr:hover {
            background-color: #f5f9ff;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            text-align: center;
            border-top: 4px solid #3498db;
        }
        
        .summary-card h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .summary-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 8px 0;
        }
        
        .summary-card .unit {
            color: #7f8c8d;
            font-size: 0.8rem;
        }
        
        .random-input-area {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .mapping-example {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 12px;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        .mapping-example strong {
            color: #2c3e50;
        }
        
        .probability-error {
            color: #e74c3c;
            font-weight: bold;
            margin-left: 20px;
        }
        
        .probability-ok {
            color: #27ae60;
            font-weight: bold;
            margin-left: 20px;
        }
        
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        .option-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .option-btn {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .option-btn:hover {
            background-color: #2980b9;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .random-numbers-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        
        .input-hint {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .simulate-btn {
            padding: 12px 30px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            margin: 20px 0;
            transition: background-color 0.3s;
        }
        
        .simulate-btn:hover {
            background-color: #27ae60;
        }
        
        .back-btn {
            padding: 10px 20px;
            background-color: #95a5a6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .input-section {
            margin: 30px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .input-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .results-section {
            margin-top: 40px;
        }
        
        .footer {
            margin-top: 40px;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding: 20px;
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Single Server Queue Simulation</h1>
            <p class="subtitle">Queue Simulation with Probability Distributions</p>
        </header>
        
        <div class="content">
            <button class="back-btn" onclick="window.location.href='index.html'">
                ← Back to Models
            </button>
            
            <h2>Single Server Queue Simulation</h2>
            
            <div class="input-section">
                <h3>Simulation Parameters</h3>
                
                <div class="input-group">
                    <label for="numCustomers">Number of Customers to Simulate:</label>
                    <input type="number" id="numCustomers" min="5" max="50" value="20">
                </div>
            </div>
            
            <div class="input-section">
                <h3>Interarrival Time Distribution</h3>
                <p>Define time between arrivals and their probabilities (Total must equal 1.0000):</p>
                
                <table class="distribution-table" id="arrivalDistributionTable">
                    <thead>
                        <tr>
                            <th>Time Between Arrivals (minutes)</th>
                            <th>Probability</th>
                            <th>Cumulative Probability</th>
                            <th>Random-Digit Assignment</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="arrivalDistributionBody">
                        <!-- Rows will be added here -->
                    </tbody>
                </table>
                
                <div>
                    <button class="add-row-btn" onclick="addArrivalRow()">+ Add Arrival Time</button>
                    <button class="remove-row-btn" onclick="removeLastArrivalRow()">- Remove Last</button>
                    <span id="arrivalProbTotal" class="probability-error">Total Probability: 0.0000 (Should be 1.0000)</span>
                </div>
                
                <div class="mapping-example">
                    <strong>How it works:</strong><br>
                    1. Enter time between arrivals and their probabilities (e.g., 0.10)<br>
                    2. System calculates cumulative probability<br>
                    3. Each probability gets: probability × 100 random numbers<br>
                    4. Random digits start from 01 (not 00)<br>
                    5. Example: Probability = 0.10 → gets 10 random numbers: 01–10
                </div>
            </div>
            
            <div class="input-section">
                <h3>Service Time Distribution</h3>
                <p>Define service times and their probabilities (Total must equal 1.0000):</p>
                
                <table class="distribution-table" id="serviceDistributionTable">
                    <thead>
                        <tr>
                            <th>Service Time (minutes)</th>
                            <th>Probability</th>
                            <th>Cumulative Probability</th>
                            <th>Random-Digit Assignment</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="serviceDistributionBody">
                        <!-- Rows will be added here -->
                    </tbody>
                </table>
                
                <div>
                    <button class="add-row-btn" onclick="addServiceRow()">+ Add Service Time</button>
                    <button class="remove-row-btn" onclick="removeLastServiceRow()">- Remove Last</button>
                    <span id="serviceProbTotal" class="probability-error">Total Probability: 0.0000 (Should be 1.0000)</span>
                </div>
            </div>
            
            <div class="input-section">
                <h3>Random Numbers Input</h3>
                <p>Enter random numbers separated by commas:</p>
                
                <div class="warning">
                    <strong>Note:</strong> Random numbers 0-99 only. 100 means 00. Numbers >100 will be capped at 99.
                </div>
                
                <div class="option-buttons">
                    <button class="option-btn" onclick="generateArrivalRandoms()">
                        Generate Arrival Random Numbers
                    </button>
                    <button class="option-btn" onclick="generateServiceRandoms()">
                        Generate Service Random Numbers
                    </button>
                </div>
                
                <div class="input-group">
                    <label for="arrivalRandoms">Interarrival Random Numbers:</label>
                    <textarea id="arrivalRandoms" class="random-numbers-input random-input-area" placeholder="Enter comma-separated random numbers, e.g., 84, 10, 74, 53, 17, 79" rows="3"></textarea>
                    <div class="input-hint">Need one less than number of customers</div>
                </div>
                
                <div class="input-group">
                    <label for="serviceRandoms">Service Time Random Numbers:</label>
                    <textarea id="serviceRandoms" class="random-numbers-input random-input-area" placeholder="Enter comma-separated random numbers, e.g., 32, 94, 79, 05, 79, 84" rows="3"></textarea>
                    <div class="input-hint">Need same as number of customers</div>
                </div>
            </div>
            
            <button class="simulate-btn" onclick="runSingleQueueSimulation()">
                Run Single Server Queue Simulation
            </button>
            
            <div class="results-section" id="resultsSection">
                <!-- Results will be inserted here -->
            </div>
        </div>
        
        <div class="footer">
            <p>Single Server Queue Simulation Tool</p>
        </div>
    </div>
    
    <script>
        // Initialize with example data from PDF
        let arrivalDistribution = [];
        let serviceDistribution = [];
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadExampleFromPDF();
        });
        
        function addArrivalRow(time = '', prob = '') {
            const tbody = document.getElementById('arrivalDistributionBody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="number" class="arrival-time" value="${time}" min="1" max="100" placeholder="e.g., 1"></td>
                <td><input type="number" class="arrival-prob" value="${prob}" min="0" max="1" step="0.001" placeholder="0.125"></td>
                <td class="arrival-cumulative">0.0000</td>
                <td class="arrival-range">01-01</td>
                <td><button onclick="this.parentElement.parentElement.remove(); updateArrivalDistribution()" style="padding: 5px 10px; background: #e74c3c; color: white; border: none; border-radius: 3px; cursor: pointer;">Remove</button></td>
            `;
            tbody.appendChild(row);
            
            // Add event listeners to inputs
            row.querySelector('.arrival-time').addEventListener('input', updateArrivalDistribution);
            row.querySelector('.arrival-prob').addEventListener('input', updateArrivalDistribution);
            
            updateArrivalDistribution();
        }
        
        function removeLastArrivalRow() {
            const tbody = document.getElementById('arrivalDistributionBody');
            if (tbody.children.length > 0) {
                tbody.lastElementChild.remove();
                updateArrivalDistribution();
            }
        }
        
        function addServiceRow(time = '', prob = '') {
            const tbody = document.getElementById('serviceDistributionBody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="number" class="service-time" value="${time}" min="1" max="100" placeholder="e.g., 1"></td>
                <td><input type="number" class="service-prob" value="${prob}" min="0" max="1" step="0.001" placeholder="0.10"></td>
                <td class="service-cumulative">0.0000</td>
                <td class="service-range">01-01</td>
                <td><button onclick="this.parentElement.parentElement.remove(); updateServiceDistribution()" style="padding: 5px 10px; background: #e74c3c; color: white; border: none; border-radius: 3px; cursor: pointer;">Remove</button></td>
            `;
            tbody.appendChild(row);
            
            // Add event listeners to inputs
            row.querySelector('.service-time').addEventListener('input', updateServiceDistribution);
            row.querySelector('.service-prob').addEventListener('input', updateServiceDistribution);
            
            updateServiceDistribution();
        }
        
        function removeLastServiceRow() {
            const tbody = document.getElementById('serviceDistributionBody');
            if (tbody.children.length > 0) {
                tbody.lastElementChild.remove();
                updateServiceDistribution();
            }
        }
        
        function updateArrivalDistribution() {
            const rows = document.getElementById('arrivalDistributionBody').children;
            let totalProb = 0;
            let cumulative = 0;
            
            arrivalDistribution = [];
            
            // First pass: collect data
            const probabilities = [];
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const time = parseFloat(row.querySelector('.arrival-time').value) || 0;
                const prob = parseFloat(row.querySelector('.arrival-prob').value) || 0;
                
                if (time > 0 && prob > 0) {
                    probabilities.push({time: time, prob: prob});
                    totalProb += prob;
                }
            }
            
            if (probabilities.length === 0) {
                // Update total probability display
                const totalElement = document.getElementById('arrivalProbTotal');
                totalElement.textContent = `Total Probability: 0.0000 (Should be 1.0000)`;
                totalElement.className = 'probability-error';
                return;
            }
            
            // Second pass: assign ranges starting from 01
            let currentRangeStart = 1; // Start from 01 instead of 00
            
            // Check if this is the specific 0.125×8 case that needs special handling
            const isSpecificCase = probabilities.length === 8 && 
                                  probabilities.every((p, i) => p.time === i+1 && Math.abs(p.prob - 0.125) < 0.001);
            
            if (isSpecificCase) {
                // Special handling for the exact case you specified
                const ranges = [
                    {start: 1, end: 12},   // 01–12 (12 numbers)
                    {start: 13, end: 25},  // 13–25 (13 numbers)
                    {start: 26, end: 37},  // 26–37 (12 numbers)
                    {start: 38, end: 50},  // 38–50 (13 numbers)
                    {start: 51, end: 62},  // 51–62 (12 numbers)
                    {start: 63, end: 75},  // 63–75 (13 numbers)
                    {start: 76, end: 87},  // 76–87 (12 numbers)
                    {start: 88, end: 0}    // 88–00 (13 numbers: 88-100)
                ];
                
                for (let i = 0; i < probabilities.length; i++) {
                    const {time, prob} = probabilities[i];
                    const range = ranges[i];
                    
                    cumulative += prob;
                    
                    // Store actual end range for mapping (88-100, not 88-00)
                    let actualEndRange = range.end === 0 ? 100 : range.end;
                    
                    arrivalDistribution.push({
                        time: time,
                        probability: prob,
                        cumulative: cumulative,
                        startRange: range.start,
                        endRange: actualEndRange,
                        displayEndRange: range.end
                    });
                    
                    // Update display for corresponding row
                    if (rows[i]) {
                        rows[i].querySelector('.arrival-cumulative').textContent = cumulative.toFixed(4);
                        rows[i].querySelector('.arrival-range').textContent = 
                            `${String(range.start).padStart(2, '0')}–${String(range.end).padStart(2, '0')}`;
                    }
                }
            } else {
                // General case: Use fair distribution algorithm (largest remainder method)
                
                // Calculate exact slots needed (probability × 100)
                const exactSlots = probabilities.map(p => p.prob * 100);
                
                // First, assign integer parts (floor)
                const integerParts = exactSlots.map(s => Math.floor(s));
                let totalAssigned = integerParts.reduce((sum, val) => sum + val, 0);
                let remainingSlots = 100 - totalAssigned;
                
                // Distribute remaining slots to items with largest fractional parts
                const fractionalParts = exactSlots.map((s, index) => ({
                    index: index,
                    fraction: s - Math.floor(s),
                    prob: probabilities[index].prob
                }));
                
                // Sort by fractional part (descending) to give remainder to largest fractions
                fractionalParts.sort((a, b) => b.fraction - a.fraction);
                
                // Create final slot counts
                const finalSlotCounts = [...integerParts];
                for (let i = 0; i < remainingSlots; i++) {
                    finalSlotCounts[fractionalParts[i].index]++;
                }
                
                // Now assign ranges based on final slot counts
                for (let i = 0; i < probabilities.length; i++) {
                    const {time, prob} = probabilities[i];
                    const numSlots = finalSlotCounts[i];
                    
                    // Calculate end range
                    let endRange;
                    if (i === probabilities.length - 1) {
                        // Ensure last item ends at 100 (or wraps to 00)
                        endRange = 100;
                        // Double-check math: if currentRangeStart + numSlots - 1 should equal 100
                        const calculatedEnd = currentRangeStart + numSlots - 1;
                        if (calculatedEnd !== 100 && calculatedEnd <= 100) {
                            endRange = calculatedEnd;
                        }
                    } else {
                        endRange = currentRangeStart + numSlots - 1;
                    }
                    
                    // Handle wrap-around: if endRange > 100, show as 00
                    let displayEndRange = endRange;
                    if (endRange === 100) {
                        displayEndRange = 0; // Show as 00 for display
                    }
                    
                    cumulative += prob;
                    
                    // Store actual values for mapping (100, not 00)
                    arrivalDistribution.push({
                        time: time,
                        probability: prob,
                        cumulative: cumulative,
                        startRange: currentRangeStart,
                        endRange: endRange === 100 ? 100 : endRange,
                        displayEndRange: displayEndRange
                    });
                    
                    // Update display for corresponding row
                    if (rows[i]) {
                        rows[i].querySelector('.arrival-cumulative').textContent = cumulative.toFixed(4);
                        rows[i].querySelector('.arrival-range').textContent = 
                            `${String(currentRangeStart).padStart(2, '0')}–${String(displayEndRange).padStart(2, '0')}`;
                    }
                    
                    currentRangeStart = endRange + 1;
                    if (currentRangeStart > 100) {
                        currentRangeStart = 1; // Wrap around (though this shouldn't happen with correct math)
                    }
                }
            }
            
            // Update total probability display
            const totalElement = document.getElementById('arrivalProbTotal');
            const tolerance = 0.0001; // Allow small floating point errors
            
            if (Math.abs(totalProb - 1.0) < tolerance) {
                totalElement.textContent = `Total Probability: ${totalProb.toFixed(4)} ✓`;
                totalElement.className = 'probability-ok';
            } else {
                totalElement.textContent = `Total Probability: ${totalProb.toFixed(4)} (Should be 1.0000)`;
                totalElement.className = 'probability-error';
            }
        }
        
        function updateServiceDistribution() {
            const rows = document.getElementById('serviceDistributionBody').children;
            let totalProb = 0;
            let cumulative = 0;
            
            serviceDistribution = [];
            
            // First pass: collect data
            const probabilities = [];
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const time = parseFloat(row.querySelector('.service-time').value) || 0;
                const prob = parseFloat(row.querySelector('.service-prob').value) || 0;
                
                if (time > 0 && prob > 0) {
                    probabilities.push({time: time, prob: prob});
                    totalProb += prob;
                }
            }
            
            if (probabilities.length === 0) {
                // Update total probability display
                const totalElement = document.getElementById('serviceProbTotal');
                totalElement.textContent = `Total Probability: 0.0000 (Should be 1.0000)`;
                totalElement.className = 'probability-error';
                return;
            }
            
            // Second pass: assign ranges starting from 01
            // Use the same fair distribution algorithm
            let currentRangeStart = 1;
            
            // Calculate exact slots needed (probability × 100)
            const exactSlots = probabilities.map(p => p.prob * 100);
            
            // First, assign integer parts (floor)
            const integerParts = exactSlots.map(s => Math.floor(s));
            let totalAssigned = integerParts.reduce((sum, val) => sum + val, 0);
            let remainingSlots = 100 - totalAssigned;
            
            // Distribute remaining slots to items with largest fractional parts
            const fractionalParts = exactSlots.map((s, index) => ({
                index: index,
                fraction: s - Math.floor(s),
                prob: probabilities[index].prob
            }));
            
            // Sort by fractional part (descending)
            fractionalParts.sort((a, b) => b.fraction - a.fraction);
            
            // Create final slot counts
            const finalSlotCounts = [...integerParts];
            for (let i = 0; i < remainingSlots; i++) {
                finalSlotCounts[fractionalParts[i].index]++;
            }
            
            // Now assign ranges based on final slot counts
            for (let i = 0; i < probabilities.length; i++) {
                const {time, prob} = probabilities[i];
                const numSlots = finalSlotCounts[i];
                
                // Calculate end range
                let endRange;
                if (i === probabilities.length - 1) {
                    // Ensure last item ends at 100 (or wraps to 00)
                    endRange = 100;
                    // Double-check math
                    const calculatedEnd = currentRangeStart + numSlots - 1;
                    if (calculatedEnd !== 100 && calculatedEnd <= 100) {
                        endRange = calculatedEnd;
                    }
                } else {
                    endRange = currentRangeStart + numSlots - 1;
                }
                
                // Handle wrap-around: if endRange > 100, show as 00
                let displayEndRange = endRange;
                if (endRange === 100) {
                    displayEndRange = 0; // Show as 00 for display
                }
                
                cumulative += prob;
                
                // Store actual values for mapping
                serviceDistribution.push({
                    time: time,
                    probability: prob,
                    cumulative: cumulative,
                    startRange: currentRangeStart,
                    endRange: endRange === 100 ? 100 : endRange,
                    displayEndRange: displayEndRange
                });
                
                // Update display for corresponding row
                if (rows[i]) {
                    rows[i].querySelector('.service-cumulative').textContent = cumulative.toFixed(4);
                    rows[i].querySelector('.service-range').textContent = 
                        `${String(currentRangeStart).padStart(2, '0')}–${String(displayEndRange).padStart(2, '0')}`;
                }
                
                currentRangeStart = endRange + 1;
                if (currentRangeStart > 100) {
                    currentRangeStart = 1;
                }
            }
            
            // Update total probability display
            const totalElement = document.getElementById('serviceProbTotal');
            const tolerance = 0.0001;
            
            if (Math.abs(totalProb - 1.0) < tolerance) {
                totalElement.textContent = `Total Probability: ${totalProb.toFixed(4)} ✓`;
                totalElement.className = 'probability-ok';
            } else {
                totalElement.textContent = `Total Probability: ${totalProb.toFixed(4)} (Should be 1.0000)`;
                totalElement.className = 'probability-error';
            }
        }
        
        function loadExampleFromPDF() {
            // Clear existing rows
            document.getElementById('arrivalDistributionBody').innerHTML = '';
            document.getElementById('serviceDistributionBody').innerHTML = '';
            
            // Load uniform arrival distribution (1-8, each with probability 0.125)
            const arrivalTimes = [1, 2, 3, 4, 5, 6, 7, 8];
            const arrivalProb = 0.125; // Each has probability 0.125
            
            arrivalTimes.forEach(time => {
                addArrivalRow(time, arrivalProb);
            });
            
            // Load the specific service distribution from your image
            const serviceData = [
                {time: 1, prob: 0.10},
                {time: 2, prob: 0.20},
                {time: 3, prob: 0.30},
                {time: 4, prob: 0.25},
                {time: 5, prob: 0.10},
                {time: 6, prob: 0.05}
            ];
            
            serviceData.forEach(data => {
                addServiceRow(data.time, data.prob);
            });
            
            // Convert PDF example random numbers from 3-digit to 2-digit
            const pdfArrivalRandoms = [913, 727, 015, 948, 309, 922, 753, 235, 302, 109, 093, 607, 738, 359, 888, 106, 212, 493, 535];
            const scaledArrivalRandoms = pdfArrivalRandoms.map(num => {
                const scaled = Math.floor(num / 10);
                return scaled > 99 ? 99 : scaled;
            });
            
            // PDF service numbers are already 2-digit
            const pdfServiceRandoms = [84, 10, 74, 53, 17, 79, 91, 67, 89, 38, 32, 94, 79, 5, 79, 84, 52, 55, 30, 50];
            
            document.getElementById('arrivalRandoms').value = scaledArrivalRandoms.join(', ');
            document.getElementById('serviceRandoms').value = pdfServiceRandoms.join(', ');
            
            // Update distributions
            updateArrivalDistribution();
            updateServiceDistribution();
            
            // Show success message
            alert('Loaded PDF example successfully! The arrival distribution now shows the correct ranges: 01–12, 13–25, 26–37, 38–50, 51–62, 63–75, 76–87, 88–00');
        }
        
        function generateArrivalRandoms() {
            const numCustomers = parseInt(document.getElementById('numCustomers').value);
            let randomNumbers = [];
            
            for (let i = 0; i < numCustomers - 1; i++) {
                // Generate numbers 0-99 (to match 00-99 format)
                randomNumbers.push(Math.floor(Math.random() * 100));
            }
            
            document.getElementById('arrivalRandoms').value = randomNumbers.join(', ');
            alert(`Generated ${numCustomers - 1} arrival random numbers (00-99)`);
        }
        
        function generateServiceRandoms() {
            const numCustomers = parseInt(document.getElementById('numCustomers').value);
            let randomNumbers = [];
            
            for (let i = 0; i < numCustomers; i++) {
                // Generate numbers 0-99 (to match 00-99 format)
                randomNumbers.push(Math.floor(Math.random() * 100));
            }
            
            document.getElementById('serviceRandoms').value = randomNumbers.join(', ');
            alert(`Generated ${numCustomers} service random numbers (00-99)`);
        }
        
        function normalizeRandomNumber(num) {
            // Convert input to number
            let n = parseInt(num);
            
            // Handle NaN
            if (isNaN(n)) {
                return 1;
            }
            
            // Handle 00 as 100 (since we're using 01-100 internally, but displaying 00 as end range)
            if (n === 0 || n === 100) {
                return 100;
            }
            
            // Cap numbers > 100 at 100
            if (n > 100) {
                return 100;
            }
            
            // Ensure number is between 1-100
            if (n < 1) {
                return 1;
            }
            
            return n;
        }
        
        function mapRandomToArrivalTime(randomDigit) {
            // Normalize random number
            const randomValue = normalizeRandomNumber(randomDigit);
            
            if (arrivalDistribution.length === 0) {
                alert('Please define arrival distribution first');
                return 1;
            }
            
            // Find which range the random number falls into
            for (let dist of arrivalDistribution) {
                const start = dist.startRange;
                const end = dist.endRange;
                
                if (randomValue >= start && randomValue <= end) {
                    return dist.time;
                }
            }
            
            // If not found (edge case), use last distribution
            return arrivalDistribution[arrivalDistribution.length - 1].time;
        }
        
        function mapRandomToServiceTime(randomDigit) {
            // Normalize random number
            const randomValue = normalizeRandomNumber(randomDigit);
            
            if (serviceDistribution.length === 0) {
                alert('Please define service distribution first');
                return 1;
            }
            
            // Find which range the random number falls into
            for (let dist of serviceDistribution) {
                const start = dist.startRange;
                const end = dist.endRange;
                
                if (randomValue >= start && randomValue <= end) {
                    return dist.time;
                }
            }
            
            // If not found (edge case), use last distribution
            return serviceDistribution[serviceDistribution.length - 1].time;
        }
        
        function runSingleQueueSimulation() {
            const numCustomers = parseInt(document.getElementById('numCustomers').value);
            
            // Validate distributions
            if (arrivalDistribution.length === 0) {
                alert('Please define arrival time distribution');
                return;
            }
            
            if (serviceDistribution.length === 0) {
                alert('Please define service time distribution');
                return;
            }
            
            // Check if probabilities sum to 1 (with tolerance)
            const arrivalTotal = arrivalDistribution.reduce((sum, dist) => sum + dist.probability, 0);
            const serviceTotal = serviceDistribution.reduce((sum, dist) => sum + dist.probability, 0);
            const tolerance = 0.0001;
            
            if (Math.abs(arrivalTotal - 1.0) > tolerance) {
                alert('Arrival probabilities must sum to exactly 1.0000');
                return;
            }
            
            if (Math.abs(serviceTotal - 1.0) > tolerance) {
                alert('Service probabilities must sum to exactly 1.0000');
                return;
            }
            
            // Parse random numbers
            const arrivalInput = document.getElementById('arrivalRandoms').value.trim();
            const serviceInput = document.getElementById('serviceRandoms').value.trim();
            
            if (!arrivalInput || !serviceInput) {
                alert('Please provide both arrival and service random numbers');
                return;
            }
            
            // Parse and normalize random numbers
            const arrivalRandoms = arrivalInput.split(',')
                .map(r => r.trim())
                .filter(r => r !== '')
                .map(normalizeRandomNumber);
            
            const serviceRandoms = serviceInput.split(',')
                .map(r => r.trim())
                .filter(r => r !== '')
                .map(normalizeRandomNumber);
            
            if (arrivalRandoms.length < numCustomers - 1) {
                alert(`Need ${numCustomers - 1} arrival random numbers, got ${arrivalRandoms.length}`);
                return;
            }
            
            if (serviceRandoms.length < numCustomers) {
                alert(`Need ${numCustomers} service random numbers, got ${serviceRandoms.length}`);
                return;
            }
            
            // Map random numbers to times
            let interarrivalTimes = [];
            for (let i = 0; i < numCustomers - 1; i++) {
                interarrivalTimes.push(mapRandomToArrivalTime(arrivalRandoms[i]));
            }
            
            let serviceTimes = [];
            for (let i = 0; i < numCustomers; i++) {
                serviceTimes.push(mapRandomToServiceTime(serviceRandoms[i]));
            }
            
            // Run simulation
            const simulation = simulateSingleQueue(interarrivalTimes, serviceTimes, arrivalRandoms, serviceRandoms);
            
            // Display results
            displaySingleQueueResults(simulation);
        }
        
        function simulateSingleQueue(interarrivalTimes, serviceTimes, arrivalRandoms, serviceRandoms) {
            let customers = [];
            let totalWaitTime = 0;
            let totalSystemTime = 0;
            let totalIdleTime = 0;
            let numWaiting = 0;
            
            let clock = 0;
            let serviceEndTime = 0;
            
            for (let i = 0; i < serviceTimes.length; i++) {
                // Calculate arrival time
                let arrivalTime;
                if (i === 0) {
                    arrivalTime = 0;
                } else {
                    arrivalTime = customers[i-1].arrivalTime + interarrivalTimes[i-1];
                }
                
                // Calculate when service begins
                let timeServiceBegins;
                if (arrivalTime >= serviceEndTime) {
                    timeServiceBegins = arrivalTime;
                    totalIdleTime += (arrivalTime - serviceEndTime);
                } else {
                    timeServiceBegins = serviceEndTime;
                }
                
                const serviceTime = serviceTimes[i];
                const timeServiceEnds = timeServiceBegins + serviceTime;
                const waitTime = timeServiceBegins - arrivalTime;
                const systemTime = timeServiceEnds - arrivalTime;
                
                if (waitTime > 0) {
                    numWaiting++;
                }
                
                totalWaitTime += waitTime;
                totalSystemTime += systemTime;
                
                customers.push({
                    customer: i + 1,
                    arrivalRandom: i === 0 ? '-' : arrivalRandoms[i-1],
                    interarrivalTime: i === 0 ? '-' : interarrivalTimes[i-1],
                    arrivalTime: arrivalTime,
                    serviceRandom: serviceRandoms[i],
                    serviceTime: serviceTime,
                    timeServiceBegins: timeServiceBegins,
                    timeServiceEnds: timeServiceEnds,
                    waitTime: waitTime,
                    systemTime: systemTime,
                    idleTime: i === 0 ? 0 : Math.max(0, arrivalTime - customers[i-1].timeServiceEnds)
                });
                
                serviceEndTime = timeServiceEnds;
                clock = timeServiceEnds;
            }
            
            return {
                customers: customers,
                totalWaitTime: totalWaitTime,
                totalSystemTime: totalSystemTime,
                totalIdleTime: totalIdleTime,
                numWaiting: numWaiting,
                totalCustomers: customers.length,
                simulationEndTime: clock
            };
        }
        
        function displaySingleQueueResults(simulation) {
            const { customers, totalWaitTime, totalSystemTime, totalIdleTime, numWaiting, totalCustomers, simulationEndTime } = simulation;
            
            // Calculate performance measures
            const avgWaitTime = totalWaitTime / totalCustomers;
            const avgSystemTime = totalSystemTime / totalCustomers;
            const probWait = numWaiting / totalCustomers;
            const probIdle = totalIdleTime / simulationEndTime;
            const avgServiceTime = customers.reduce((sum, cust) => sum + cust.serviceTime, 0) / totalCustomers;
            const avgInterarrivalTime = customers.slice(1).reduce((sum, cust) => sum + cust.interarrivalTime, 0) / (totalCustomers - 1);
            
            // Show distribution tables WITHOUT "# of Slots" column
            let distributionHTML = `
                <h3>Arrival Time Distribution</h3>
                <table class="distribution-table">
                    <thead>
                        <tr>
                            <th>Time Between Arrivals</th>
                            <th>Probability</th>
                            <th>Cumulative</th>
                            <th>Random Number Range</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            arrivalDistribution.forEach(dist => {
                distributionHTML += `
                    <tr>
                        <td>${dist.time} minutes</td>
                        <td>${dist.probability.toFixed(4)}</td>
                        <td>${dist.cumulative.toFixed(4)}</td>
                        <td>${String(dist.startRange).padStart(2, '0')}-${String(dist.endRange).padStart(2, '0')}</td>
                    </tr>
                `;
            });
            
            distributionHTML += `
                    </tbody>
                </table>
                
                <h3 style="margin-top: 30px;">Service Time Distribution</h3>
                <table class="distribution-table">
                    <thead>
                        <tr>
                            <th>Service Time</th>
                            <th>Probability</th>
                            <th>Cumulative</th>
                            <th>Random Number Range</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            serviceDistribution.forEach(dist => {
                distributionHTML += `
                    <tr>
                        <td>${dist.time} minutes</td>
                        <td>${dist.probability.toFixed(4)}</td>
                        <td>${dist.cumulative.toFixed(4)}</td>
                        <td>${String(dist.startRange).padStart(2, '0')}-${String(dist.endRange).padStart(2, '0')}</td>
                    </tr>
                `;
            });
            
            distributionHTML += `
                    </tbody>
                </table>
            `;
            
            // Create simulation table WITHOUT HIGHLIGHTING
            let tableHTML = `
                <h3 style="margin-top: 30px;">Simulation Table for ${totalCustomers} Customers</h3>
                <div class="simulation-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Cust #</th>
                                <th>Arrival Random</th>
                                <th>Interarrival Time</th>
                                <th>Arrival Time</th>
                                <th>Service Random</th>
                                <th>Service Time</th>
                                <th>Time Service Begins</th>
                                <th>Time Service Ends</th>
                                <th>Wait Time</th>
                                <th>System Time</th>
                                <th>Idle Time</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            customers.forEach(customer => {
                tableHTML += `
                    <tr>
                        <td>${customer.customer}</td>
                        <td>${String(customer.arrivalRandom).padStart(2, '0')}</td>
                        <td>${customer.interarrivalTime}</td>
                        <td>${customer.arrivalTime}</td>
                        <td>${String(customer.serviceRandom).padStart(2, '0')}</td>
                        <td>${customer.serviceTime}</td>
                        <td>${customer.timeServiceBegins}</td>
                        <td>${customer.timeServiceEnds}</td>
                        <td>${customer.waitTime}</td>
                        <td>${customer.systemTime}</td>
                        <td>${customer.idleTime}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        <tr style="background-color: #f8f9fa; font-weight: bold;">
                            <td colspan="8"><strong>Totals / Averages</strong></td>
                            <td><strong>${totalWaitTime}</strong><br>(${avgWaitTime.toFixed(2)} avg)</td>
                            <td><strong>${totalSystemTime}</strong><br>(${avgSystemTime.toFixed(2)} avg)</td>
                            <td><strong>${totalIdleTime.toFixed(1)}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            `;
            
            // Create summary cards
            const summaryHTML = `
                <div class="summary-cards">
                    <div class="summary-card">
                        <h4>Average Waiting Time</h4>
                        <div class="value">${avgWaitTime.toFixed(2)}</div>
                        <div class="unit">minutes</div>
                    </div>
                    <div class="summary-card">
                        <h4>Probability of Waiting</h4>
                        <div class="value">${(probWait * 100).toFixed(1)}%</div>
                        <div class="unit">${numWaiting}/${totalCustomers} customers</div>
                    </div>
                    <div class="summary-card">
                        <h4>Server Idle Probability</h4>
                        <div class="value">${(probIdle * 100).toFixed(1)}%</div>
                        <div class="unit">${totalIdleTime.toFixed(1)}/${simulationEndTime} minutes</div>
                    </div>
                    <div class="summary-card">
                        <h4>Average Service Time</h4>
                        <div class="value">${avgServiceTime.toFixed(2)}</div>
                        <div class="unit">minutes</div>
                    </div>
                    <div class="summary-card">
                        <h4>Average Interarrival Time</h4>
                        <div class="value">${avgInterarrivalTime.toFixed(2)}</div>
                        <div class="unit">minutes</div>
                    </div>
                    <div class="summary-card">
                        <h4>Average Time in System</h4>
                        <div class="value">${avgSystemTime.toFixed(2)}</div>
                        <div class="unit">minutes</div>
                    </div>
                </div>
            `;
            
            // Combine everything
            document.getElementById('resultsSection').innerHTML = `
                ${distributionHTML}
                ${tableHTML}
                ${summaryHTML}
            `;
        }
        
        function showNotification(message, type) {
            // Simple notification function
            alert(message);
        }
    </script>
</body>
</html>