<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mathematical Queueing Model - Queuing Simulation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ============================================
           GLOBAL RESET & BASE STYLES
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
            line-height: 1.6;
        }

        /* ============================================
           CONTAINER & LAYOUT
           ============================================ */
        .container {
            width: 100%;
            max-width: 1600px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            margin: 0 auto;
            padding: 20px;
        }

        .content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        /* ============================================
           HEADER STYLES
           ============================================ */
        header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: white;
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 2rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 5px;
            color: rgba(255, 255, 255, 0.9);
        }

        .author {
            font-size: 0.9rem;
            opacity: 0.7;
            font-style: italic;
            color: rgba(255, 255, 255, 0.7);
        }

        /* ============================================
           BUTTON STYLES
           ============================================ */
        /* Back Button */
        .back-btn {
            padding: 10px 20px;
            background-color: #7f8c8d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 25px;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-btn:hover {
            background-color: #6c7b7d;
        }

        /* Option Buttons */
        .option-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .option-btn {
            padding: 12px 20px;
            border: 2px solid #3498db;
            background-color: white;
            color: #3498db;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            min-width: 200px;
        }

        .option-btn:hover, .option-btn.active {
            background-color: #3498db;
            color: white;
        }

        /* Action Buttons */
        .add-row-btn, .remove-row-btn {
            padding: 10px 18px;
            margin: 8px 5px 8px 0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .add-row-btn {
            background-color: #2ecc71;
            color: white;
        }

        .add-row-btn:hover {
            background-color: #27ae60;
        }

        .remove-row-btn {
            background-color: #e74c3c;
            color: white;
        }

        .remove-row-btn:hover {
            background-color: #c0392b;
        }

        .simulate-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            margin: 30px 0;
            transition: all 0.3s;
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }

        .simulate-btn:hover {
            background: linear-gradient(135deg, #27ae60, #219653);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        /* ============================================
           INPUT & FORM STYLES
           ============================================ */
        .input-section {
            margin: 30px 0;
            padding: 25px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 5px solid #3498db;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-field {
            display: flex;
            flex-direction: column;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #34495e;
        }

        input[type="number"], 
        input[type="text"], 
        select, 
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        input:focus, 
        select:focus, 
        textarea:focus {
            outline: none;
            border-color: #4a6fa5;
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }

        .random-numbers-input {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }

        .input-hint {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        /* ============================================
           TABLE STYLES
           ============================================ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: center;
        }

        th {
            background-color: #f2f6fc;
            font-weight: 600;
            color: #2c3e50;
        }

        .distribution-table {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .distribution-table th {
            background-color: #2c3e50;
            color: white;
            padding: 14px;
        }

        .distribution-table td {
            padding: 12px;
            border: 1px solid #e1e1e1;
        }

        .results-table {
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-radius: 5px;
            overflow: hidden;
        }

        .results-table th {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            text-align: left;
        }

        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        .results-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .results-table tr:hover {
            background-color: #f1f8ff;
        }

        /* ============================================
           HIGHLIGHT STYLES
           ============================================ */
        .highlight {
            background-color: #e8f4fd;
            font-weight: 600;
        }

        /* ============================================
           RESULT & SUMMARY STYLES
           ============================================ */
        .results-section {
            margin-top: 40px;
        }

        .results-header {
            color: #2c3e50;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            text-align: center;
            border-top: 5px solid #3498db;
        }

        .summary-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }

        .summary-card .unit {
            color: #7f8c8d;
            font-size: 0.85rem;
        }

        /* ============================================
           STATUS INDICATORS
           ============================================ */
        .system-status {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .system-status.stable {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .system-status.unstable {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .probability-status {
            font-weight: bold;
            margin-left: 20px;
            padding: 8px 15px;
            border-radius: 5px;
        }

        .probability-error {
            background-color: #ffeaea;
            color: #e74c3c;
        }

        .probability-ok {
            background-color: #e8f7ef;
            color: #27ae60;
        }

        .conclusion {
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-weight: 600;
            text-align: center;
        }

        .pass {
            background-color: #e7f7e7;
            color: #2d572c;
            border: 1px solid #c1e6c1;
        }

        .fail {
            background-color: #fdeaea;
            color: #a94442;
            border: 1px solid #f5c6cb;
        }

        /* ============================================
           SPECIAL ELEMENTS
           ============================================ */
        .formula-box {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
        }

        .formula {
            color: #2c3e50;
            font-weight: bold;
            display: block;
            margin: 5px 0;
            font-family: 'Cambria', 'Times New Roman', serif;
            font-size: 1.1rem;
            background-color: #f9f9f9;
            padding: 10px 15px;
            border-radius: 5px;
            text-align: center;
        }

        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 12px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .mapping-example {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .mapping-example strong {
            color: #2c3e50;
        }

        .parameter-display {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2ecc71;
        }

        .parameter-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .parameter-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .parameter-value {
            font-weight: bold;
            color: #3498db;
        }

        /* ============================================
           FOOTER
           ============================================ */
        .footer {
            margin-top: 40px;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding: 20px;
            border-top: 1px solid #eee;
        }

        /* ============================================
           RESPONSIVE DESIGN
           ============================================ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            header {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.7rem;
            }
            
            h3 {
                font-size: 1.3rem;
            }
            
            .option-buttons {
                flex-direction: column;
            }
            
            .option-btn {
                min-width: auto;
                width: 100%;
            }
            
            .input-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            input, select {
                width: 100%;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
        }

        /* ============================================
           THEORY & WELCOME SECTIONS
           ============================================ */
        .theory-summary {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid #3498db;
            margin-top: 30px;
        }

        .theory-summary h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .theory-summary ul {
            list-style-type: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .theory-summary li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            color: #555;
            font-size: 0.95rem;
        }

        .theory-summary li strong {
            color: #2c3e50;
            display: inline-block;
            width: 60px;
        }

        /* ============================================
           DOWNLOAD BUTTONS
           ============================================ */
        .download-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .download-btn.pdf {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .download-btn.excel {
            background: linear-gradient(135deg, #28a745, #218838);
        }
        
        .download-btn i {
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Mathematical Queueing Model</h1>
            <p class="subtitle">Queue Performance Measures Calculator</p>
        </header>
        
        <div class="content">
            <button class="back-btn" onclick="window.location.href='index.html'">
                <i class="fas fa-arrow-left"></i> Back to Models
            </button>
            
            <h2>Mathematical Queueing Model</h2>
            
            <div class="input-section">
                <h3>Queue Parameters</h3>
                
                <div class="input-group">
                    <label for="arrivalRate">Arrival Rate (λ) - customers per time unit:</label>
                    <input type="number" id="arrivalRate" min="0.1" max="100" step="0.1" value="4" placeholder="e.g., 4 customers/hour">
                    <div class="input-hint">Average number of customers arriving per time unit</div>
                </div>
                
                <div class="input-group">
                    <label for="serviceRate">Service Rate (μ) - customers per time unit:</label>
                    <input type="number" id="serviceRate" min="0.1" max="100" step="0.1" value="5" placeholder="e.g., 5 customers/hour">
                    <div class="input-hint">Average number of customers that can be served per time unit</div>
                </div>
            </div>
            
            <button class="simulate-btn" onclick="calculateQueueMeasures()">
                <i class="fas fa-calculator"></i> Calculate Queue Performance Measures
            </button>
            
            <div class="results-section" id="resultsSection">
                <!-- Results will be inserted here -->
            </div>
            
            <div class="input-section example-section">
                <h3>Example from PDF</h3>
                <p>Repair facility example from Chapter 4:</p>
                <ul>
                    <li>λ = 4 machines/hour (Poisson arrivals)</li>
                    <li>μ = 5 machines/hour (Exponential service, 12 min/machine)</li>
                </ul>
                <button class="option-btn" onclick="loadExample()" style="width: 100%;">
                    <i class="fas fa-file-pdf"></i> Load Lecture Example 
                </button>
            </div>
            
            <div class="theory-summary">
                <h3>Queueing Theory Basics</h3>
                <ul>
                    <li><strong>λ:</strong> Arrival rate (customers/time unit)</li>
                    <li><strong>μ:</strong> Service rate (customers/time unit)</li>
                    <li><strong>ρ:</strong> Utilization factor (λ/μ)</li>
                    <li><strong>Ls:</strong> Expected number of customers in system</li>
                    <li><strong>Lq:</strong> Expected number of customers in queue</li>
                    <li><strong>Ws:</strong> Expected waiting time in system</li>
                    <li><strong>Wq:</strong> Expected waiting time in queue</li>
                    <li><strong>P₀:</strong> Probability system is empty</li>
                </ul>
                
                <div class="formula-box">
                    <h4>Formulas (M/M/1 Queue)</h4>
                    <div class="formula">Ls = λ / (μ - λ)</div>
                    <div class="formula">Lq = λ² / [μ(μ - λ)]</div>
                    <div class="formula">Ws = 1 / (μ - λ)</div>
                    <div class="formula">Wq = λ / [μ(μ - λ)]</div>
                    <div class="formula">P₀ = 1 - ρ</div>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Include jsPDF from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    
    <!-- Shared Script Functions -->
    <script>
        // Global variables to store calculation results
        let currentResults = null;
        
        // Use the shared showNotification function from your script
        function loadExample() {
            document.getElementById('arrivalRate').value = 4;
            document.getElementById('serviceRate').value = 5;
            showNotification('Loaded repair facility example: λ=4, μ=5', 'info');
            calculateQueueMeasures();
        }
        
        function calculateQueueMeasures() {
            const arrivalRate = parseFloat(document.getElementById('arrivalRate').value);
            const serviceRate = parseFloat(document.getElementById('serviceRate').value);
            
            // Validation
            if (!arrivalRate || !serviceRate) {
                showNotification('Please enter both arrival and service rates', 'error');
                return;
            }
            
            if (arrivalRate <= 0 || serviceRate <= 0) {
                showNotification('Rates must be positive numbers', 'error');
                return;
            }
            
            const isStable = arrivalRate < serviceRate;
            
            // Calculate performance measures
            const utilization = arrivalRate / serviceRate;
            const ls = isStable ? arrivalRate / (serviceRate - arrivalRate) : Infinity;
            const lq = isStable ? (arrivalRate * arrivalRate) / (serviceRate * (serviceRate - arrivalRate)) : Infinity;
            const ws = isStable ? 1 / (serviceRate - arrivalRate) : Infinity;
            const wq = isStable ? arrivalRate / (serviceRate * (serviceRate - arrivalRate)) : Infinity;
            const p0 = 1 - utilization;
            
            // Store results globally for download
            currentResults = {
                arrivalRate,
                serviceRate,
                isStable,
                utilization,
                ls,
                lq,
                ws,
                wq,
                p0,
                calculatedAt: new Date().toLocaleString()
            };
            
            // Generate results HTML
            let resultsHTML = `
                <h3 class="results-header">Queue Performance Measures</h3>
                <div class="system-status ${isStable ? 'stable' : 'unstable'}">
                    <strong>System Status:</strong> ${isStable ? 'STABLE' : 'UNSTABLE'}<br>
                    <strong>Traffic Intensity (ρ):</strong> ${utilization.toFixed(4)} = ${(utilization * 100).toFixed(1)}%
                </div>
                
                <div class="summary-cards">
                    <div class="summary-card">
                        <h4>Arrival Rate</h4>
                        <div class="value">${arrivalRate.toFixed(2)}</div>
                        <div class="unit">customers/time unit</div>
                    </div>
                    <div class="summary-card">
                        <h4>Service Rate</h4>
                        <div class="value">${serviceRate.toFixed(2)}</div>
                        <div class="unit">customers/time unit</div>
                    </div>
                    <div class="summary-card">
                        <h4>Utilization</h4>
                        <div class="value">${(utilization * 100).toFixed(1)}%</div>
                        <div class="unit">ρ = ${utilization.toFixed(3)}</div>
                    </div>
                    <div class="summary-card">
                        <h4>System Empty</h4>
                        <div class="value">${(p0 * 100).toFixed(1)}%</div>
                        <div class="unit">P₀ = ${p0.toFixed(3)}</div>
                    </div>
                </div>
                
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Performance Measure</th>
                            <th>Symbol</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Average Customers in System</td>
                            <td>Ls</td>
                            <td>${isStable ? ls.toFixed(4) : '∞'}</td>
                        </tr>
                        <tr>
                            <td>Average Customers in Queue</td>
                            <td>Lq</td>
                            <td>${isStable ? lq.toFixed(4) : '∞'}</td>
                        </tr>
                        <tr>
                            <td>Average Time in System</td>
                            <td>Ws</td>
                            <td>${isStable ? ws.toFixed(4) : '∞'} time units</td>
                        </tr>
                        <tr>
                            <td>Average Waiting Time in Queue</td>
                            <td>Wq</td>
                            <td>${isStable ? wq.toFixed(4) : '∞'} time units</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="download-section">
                    <button class="download-btn pdf" onclick="generatePDF()">
                        <i class="fas fa-file-pdf"></i> Download as PDF
                    </button>
                    <button class="download-btn excel" onclick="downloadExcel()">
                        <i class="fas fa-file-excel"></i> Download as Excel
                    </button>
                </div>
            `;
            
            document.getElementById('resultsSection').innerHTML = resultsHTML;
            showNotification('Queue performance measures calculated successfully!', 'success');
        }
        
        function generatePDF() {
            if (!currentResults) {
                showNotification('No results to download. Please calculate first.', 'error');
                return;
            }
            
            try {
                // Check if jsPDF is loaded
                if (typeof window.jspdf === 'undefined') {
                    showNotification('Error: PDF library not loaded. Please check your internet connection.', 'error');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(20);
                doc.setTextColor(44, 62, 80); // Dark blue color
                doc.text("Queueing Model Results", 105, 15, null, null, 'center');
                
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.text(`Generated on: ${currentResults.calculatedAt}`, 105, 25, null, null, 'center');
                
                // Add system status
                doc.setFontSize(14);
                doc.setTextColor(44, 62, 80);
                doc.text("System Status", 20, 40);
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text(`Status: ${currentResults.isStable ? 'STABLE' : 'UNSTABLE'}`, 20, 50);
                doc.text(`Traffic Intensity (ρ): ${currentResults.utilization.toFixed(4)} (${(currentResults.utilization * 100).toFixed(1)}%)`, 20, 58);
                
                // Add performance measures
                doc.setFontSize(14);
                doc.setTextColor(44, 62, 80);
                doc.text("Performance Measures", 20, 75);
                
                // Create simple table without autoTable
                const startY = 85;
                const col1 = 20;
                const col2 = 80;
                const col3 = 140;
                const lineHeight = 10;
                
                // Table headers
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text("Measure", col1, startY);
                doc.text("Symbol", col2, startY);
                doc.text("Value", col3, startY);
                
                // Draw line under headers
                doc.line(col1, startY + 2, 190, startY + 2);
                
                // Table rows
                doc.setFont(undefined, 'normal');
                let y = startY + lineHeight;
                
                doc.text("Arrival Rate", col1, y);
                doc.text("λ", col2, y);
                doc.text(`${currentResults.arrivalRate.toFixed(2)} customers/time unit`, col3, y);
                
                y += lineHeight;
                doc.text("Service Rate", col1, y);
                doc.text("μ", col2, y);
                doc.text(`${currentResults.serviceRate.toFixed(2)} customers/time unit`, col3, y);
                
                y += lineHeight;
                doc.text("Server Utilization", col1, y);
                doc.text("ρ", col2, y);
                doc.text(`${currentResults.utilization.toFixed(4)} (${(currentResults.utilization * 100).toFixed(1)}%)`, col3, y);
                
                y += lineHeight;
                doc.text("Avg Customers in System", col1, y);
                doc.text("Ls", col2, y);
                doc.text(currentResults.isStable ? currentResults.ls.toFixed(4) : '∞', col3, y);
                
                y += lineHeight;
                doc.text("Avg Customers in Queue", col1, y);
                doc.text("Lq", col2, y);
                doc.text(currentResults.isStable ? currentResults.lq.toFixed(4) : '∞', col3, y);
                
                y += lineHeight;
                doc.text("Avg Time in System", col1, y);
                doc.text("Ws", col2, y);
                doc.text(currentResults.isStable ? currentResults.ws.toFixed(4) + ' time units' : '∞', col3, y);
                
                y += lineHeight;
                doc.text("Avg Waiting Time in Queue", col1, y);
                doc.text("Wq", col2, y);
                doc.text(currentResults.isStable ? currentResults.wq.toFixed(4) + ' time units' : '∞', col3, y);
                
                y += lineHeight;
                doc.text("Probability System Empty", col1, y);
                doc.text("P₀", col2, y);
                doc.text(`${currentResults.p0.toFixed(4)} (${(currentResults.p0 * 100).toFixed(1)}%)`, col3, y);
                
                // Add formulas section
                y += lineHeight * 2;
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(44, 62, 80);
                doc.text("Formulas (M/M/1 Queue)", 20, y);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(0, 0, 0);
                
                y += lineHeight;
                doc.text("Ls = λ / (μ - λ)", 25, y);
                y += lineHeight;
                doc.text("Lq = λ² / [μ(μ - λ)]", 25, y);
                y += lineHeight;
                doc.text("Ws = 1 / (μ - λ)", 25, y);
                y += lineHeight;
                doc.text("Wq = λ / [μ(μ - λ)]", 25, y);
                y += lineHeight;
                doc.text("P₀ = 1 - ρ", 25, y);
                
                // Add footer
                const pageHeight = doc.internal.pageSize.height;
                doc.setFontSize(10);
                doc.setTextColor(128, 128, 128);
                
                // Save the PDF
                doc.save(`queueing-results-${new Date().getTime()}.pdf`);
                showNotification('PDF downloaded successfully!', 'success');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showNotification('Error generating PDF. Please try again.', 'error');
                
                // Fallback: Create a simple text file
                const textContent = generateTextReport();
                const blob = new Blob([textContent], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `queueing-results-${new Date().getTime()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showNotification('Downloaded as text file instead.', 'info');
            }
        }
        
        function generateTextReport() {
            return `QUEUEING MODEL RESULTS
Generated on: ${currentResults.calculatedAt}

SYSTEM STATUS
Status: ${currentResults.isStable ? 'STABLE' : 'UNSTABLE'}
Traffic Intensity (ρ): ${currentResults.utilization.toFixed(4)} (${(currentResults.utilization * 100).toFixed(1)}%)

PERFORMANCE MEASURES
Arrival Rate (λ): ${currentResults.arrivalRate.toFixed(2)} customers/time unit
Service Rate (μ): ${currentResults.serviceRate.toFixed(2)} customers/time unit
Server Utilization (ρ): ${currentResults.utilization.toFixed(4)} (${(currentResults.utilization * 100).toFixed(1)}%)
Avg Customers in System (Ls): ${currentResults.isStable ? currentResults.ls.toFixed(4) : '∞'}
Avg Customers in Queue (Lq): ${currentResults.isStable ? currentResults.lq.toFixed(4) : '∞'}
Avg Time in System (Ws): ${currentResults.isStable ? currentResults.ws.toFixed(4) + ' time units' : '∞'}
Avg Waiting Time in Queue (Wq): ${currentResults.isStable ? currentResults.wq.toFixed(4) + ' time units' : '∞'}
Probability System Empty (P₀): ${currentResults.p0.toFixed(4)} (${(currentResults.p0 * 100).toFixed(1)}%)

FORMULAS (M/M/1 Queue)
Ls = λ / (μ - λ)
Lq = λ² / [μ(μ - λ)]
Ws = 1 / (μ - λ)
Wq = λ / [μ(μ - λ)]
P₀ = 1 - ρ`;
        }
        
        function downloadExcel() {
            if (!currentResults) {
                showNotification('No results to download. Please calculate first.', 'error');
                return;
            }
            
            try {
                // Create worksheet data
                const wsData = [
                    ["QUEUEING MODEL RESULTS"],
                    [`Generated on: ${currentResults.calculatedAt}`],
                    [""],
                    ["SYSTEM STATUS"],
                    ["Status:", currentResults.isStable ? "STABLE" : "UNSTABLE"],
                    ["Traffic Intensity (ρ):", `${currentResults.utilization.toFixed(4)} (${(currentResults.utilization * 100).toFixed(1)}%)`],
                    [""],
                    ["PERFORMANCE MEASURES"],
                    ["Measure", "Symbol", "Value"],
                    ["Arrival Rate", "λ", currentResults.arrivalRate.toFixed(2)],
                    ["Service Rate", "μ", currentResults.serviceRate.toFixed(2)],
                    ["Server Utilization", "ρ", currentResults.utilization.toFixed(4)],
                    ["Avg Customers in System", "Ls", currentResults.isStable ? currentResults.ls.toFixed(4) : '∞'],
                    ["Avg Customers in Queue", "Lq", currentResults.isStable ? currentResults.lq.toFixed(4) : '∞'],
                    ["Avg Time in System", "Ws", currentResults.isStable ? currentResults.ws.toFixed(4) : '∞'],
                    ["Avg Waiting Time in Queue", "Wq", currentResults.isStable ? currentResults.wq.toFixed(4) : '∞'],
                    ["Probability System Empty", "P₀", currentResults.p0.toFixed(4)],
                    [""],
                    ["FORMULAS (M/M/1 Queue)"],
                    ["Ls = λ / (μ - λ)"],
                    ["Lq = λ² / [μ(μ - λ)]"],
                    ["Ws = 1 / (μ - λ)"],
                    ["Wq = λ / [μ(μ - λ)]"],
                    ["P₀ = 1 - ρ"]
                ];
                
                // Create workbook and worksheet
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                
                // Set column widths
                ws['!cols'] = [
                    {wch: 30}, // Measure column
                    {wch: 10}, // Symbol column
                    {wch: 25}  // Value column
                ];
                
                // Add worksheet to workbook
                XLSX.utils.book_append_sheet(wb, ws, "Queue Results");
                
                // Generate and download Excel file
                XLSX.writeFile(wb, `queueing-results-${new Date().getTime()}.xlsx`);
                showNotification('Excel file downloaded successfully!', 'success');
                
            } catch (error) {
                console.error('Excel generation error:', error);
                showNotification('Error generating Excel file. Please try again.', 'error');
            }
        }
        
        // Initialize with example values
        document.addEventListener('DOMContentLoaded', function() {
            // Calculate on page load with default values
            setTimeout(calculateQueueMeasures, 100);
        });
    </script>
    
    <!-- Include your shared scripts.js file -->
    <script src="scripts.js"></script>
</body>
</html>